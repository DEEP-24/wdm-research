generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String @id @default(uuid()) @map("id")
  firstName String
  lastName  String

  email    String @unique
  password String

  imageURL String

  researchInterests String
  expertise         String

  lastPasswordResetAt DateTime?

  role UserRole

  phone   String
  street  String
  aptNo   String
  city    String
  state   String
  zipcode String
  dob     DateTime

  linkedInURL String?
  twitterURL  String?
  githubURL   String?
  papers      String?

  events Event[]

  registrations EventRegistration[]

  projectProposals ProjectProposal[]

  proposalReviews ProposalReview[]

  followers  Followers[] @relation("follower")
  followings Followers[] @relation("following")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sharedFiles SharedFile[]

  forums Forum[]
  posts  Post[]

  submittedApplications GrantApplication[] @relation("SubmittedApplications")
  reviewedApplications  GrantApplication[] @relation("ReviewedApplications")

  @@map("users")
}

model Followers {
  follower    User   @relation("follower", fields: [followerId], references: [id])
  followerId  String
  following   User   @relation("following", fields: [followingId], references: [id])
  followingId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("followers")
}

model Event {
  id                   String    @id @default(uuid()) @map("id")
  title                String
  description          String?
  startDate            DateTime?
  endDate              DateTime?
  location             String?
  isVirtual            Boolean   @default(false)
  maxAttendees         Int?
  registrationDeadline DateTime?
  status               String?

  sessions      EventSession[]
  registrations EventRegistration[]

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("events")
}

model EventSession {
  id           String    @id @default(uuid()) @map("id")
  title        String
  description  String?
  startTime    DateTime?
  endTime      DateTime?
  location     String?
  maxAttendees Int?

  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId String

  registrations EventRegistration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("event_sessions")
}

model EventRegistration {
  id          String   @id @default(uuid()) @map("id")
  bookingDate DateTime @default(now())

  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId String

  session   EventSession? @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  sessionId String?

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("event_registrations")
}

model ProjectProposal {
  id              String           @id @default(uuid()) @map("id")
  title           String
  description     String?
  status          ProposalStatus   @default(SUBMITTED)
  submittedAt     DateTime         @default(now()) @db.Timestamp(6)
  attachments     String?
  proposalReviews ProposalReview[]

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  GrantApplication GrantApplication[]

  @@map("project_proposals")
}

model ProposalReview {
  id String @id @default(uuid()) @map("id")

  feedback   String?
  reviewedAt DateTime @default(now()) @db.Timestamp(6)

  projectProposal   ProjectProposal? @relation(fields: [projectProposalId], references: [id])
  projectProposalId String?

  reviewer   User   @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  reviewerId String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("proposal_reviews")
}

model SharedFile {
  id String @id @default(uuid()) @map("id")

  customName String

  uploadDate DateTime @default(now())
  fileUrl    String

  uploadedBy User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("shared_files")
}

model Forum {
  id          String @id @default(uuid()) @map("id")
  name        String
  description String
  posts       Post[]

  createdBy   User   @relation(fields: [createdById], references: [id], onDelete: Cascade)
  createdById String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("forums")
}

model Post {
  id      String @id @default(uuid()) @map("id")
  title   String
  content String @db.Text

  forum   Forum  @relation(fields: [forumId], references: [id], onDelete: Cascade)
  forumId String

  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("posts")
}

model GrantApplication {
  id                String          @id @default(uuid()) @map("id")
  projectProposal   ProjectProposal @relation(fields: [projectProposalId], references: [id], onDelete: Cascade)
  projectProposalId String
  requestAmount     Float
  keywords          String
  status            GrantStatus     @default(SUBMITTED)
  attachments       Json? // Will store array of {name: string, type: string, url: string}

  reviewedBy   User?   @relation("ReviewedApplications", fields: [reviewedById], references: [id])
  reviewedById String?

  submittedBy   User   @relation("SubmittedApplications", fields: [submittedById], references: [id])
  submittedById String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("grant_applications")
}

enum UserRole {
  ADMIN
  ORGANIZER
  INVESTOR
  USER
}

enum ProposalStatus {
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
}

enum GrantStatus {
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
}
